<div class="page-container">
    <!-- Premium Header -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-title-wrapper">
                <i class="fas fa-users page-icon"></i>
                <div>
                    <h2 class="page-title">{{ '::Artists' | abpLocalization }}</h2>
                    <p class="page-subtitle">{{ artists.totalCount }} {{ '::Artists' | abpLocalization }}</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="btn-group me-3" role="group">
                    <button type="button" class="btn btn-outline-secondary" [class.active]="viewMode === 'table'"
                        (click)="viewMode = 'table'" title="Tabela">
                        <i class="fa fa-list"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" [class.active]="viewMode === 'grid'"
                        (click)="viewMode = 'grid'" title="Grade">
                        <i class="fa fa-th-large"></i>
                    </button>
                </div>
                <button *abpPermission="'ShowZen.Artists.Create'" class="btn btn-primary" type="button"
                    (click)="createArtist()">
                    <i class="fa fa-plus me-2"></i>
                    <span>{{ '::NewArtist' | abpLocalization }}</span>
                </button>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body p-3">
            <form [formGroup]="filterForm">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="search-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="form-control" formControlName="filter"
                                [placeholder]="'::Search' | abpLocalization">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" formControlName="type">
                            <option [ngValue]="null">{{ '::AllTypes' | abpLocalization }}</option>
                            <option *ngFor="let type of artistTypes" [ngValue]="type.value">
                                {{ '::ArtistType:' + type.label | abpLocalization }}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" formControlName="isActive">
                            <option [ngValue]="null">{{ '::AllStatus' | abpLocalization }}</option>
                            <option [ngValue]="true">{{ '::Active' | abpLocalization }}</option>
                            <option [ngValue]="false">{{ '::Inactive' | abpLocalization }}</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Table View -->
    <div class="card" *ngIf="viewMode === 'table'">
        <div class="card-body">
            <ngx-datatable [rows]="artists.items" [count]="artists.totalCount" [list]="list" default>
                <ngx-datatable-column [name]="'::ArtistName' | abpLocalization" prop="name" [minWidth]="200">
                </ngx-datatable-column>
                <ngx-datatable-column [name]="'::ArtistType' | abpLocalization" prop="type" [minWidth]="150">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        {{ '::ArtistType:' + getArtistTypeName(row.type) | abpLocalization }}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column [name]="'::IsActive' | abpLocalization" prop="isActive" [maxWidth]="100">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        <span class="badge" [class.bg-success]="row.isActive" [class.bg-secondary]="!row.isActive">
                            {{ (row.isActive ? '::Yes' : '::No') | abpLocalization }}
                        </span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column [name]="'::Actions' | abpLocalization" [maxWidth]="140" [sortable]="false">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        <div class="action-buttons">
                            <button *abpPermission="'ShowZen.Artists.Edit'" class="btn btn-ghost btn-sm action-btn"
                                (click)="editArtist(row.id)" title="{{ '::Edit' | abpLocalization }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button *abpPermission="'ShowZen.Artists.Delete'"
                                class="btn btn-ghost btn-sm action-btn text-danger" (click)="delete(row.id)"
                                title="{{ '::Delete' | abpLocalization }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
        </div>
    </div>

    <!-- Grid View (Cards) -->
    <div class="row" *ngIf="viewMode === 'grid'">
        <div class="col-xl-3 col-lg-4 col-md-6 mb-4" *ngFor="let artist of artists.items">
            <div class="artist-card-v2">
                <div class="card-body-content">
                    <div class="card-status-badge" [class.active]="artist.isActive">
                        {{ (artist.isActive ? '::Active' : '::Inactive') | abpLocalization }}
                    </div>
                    <div class="card-profile-wrapper">
                        <div class="profile-pic">
                            <img *ngIf="artist.logoUrl" [src]="artist.logoUrl" alt="Logo">
                            <i *ngIf="!artist.logoUrl" class="fas fa-user-music"></i>
                        </div>
                    </div>
                    <div class="card-text-center">
                        <h4 class="artist-name">{{ artist.name }}</h4>
                        <span class="artist-type-badge">
                            {{ '::ArtistType:' + getArtistTypeName(artist.type) | abpLocalization }}
                        </span>
                        <p class="artist-bio">{{ artist.biography | slice:0:100 }}{{ artist.biography?.length > 100 ?
                            '...' : '' }}</p>
                    </div>
                    <div class="card-footer-actions">
                        <button *abpPermission="'ShowZen.Artists.Edit'"
                            class="btn btn-outline-primary btn-sm rounded-pill" (click)="editArtist(artist.id)">
                            <i class="fas fa-edit me-1"></i> {{ '::Edit' | abpLocalization }}
                        </button>
                        <button *abpPermission="'ShowZen.Artists.Delete'"
                            class="btn btn-outline-danger btn-sm rounded-pill" (click)="delete(artist.id)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <abp-modal [(visible)]="isModalOpen">
        <ng-template #abpHeader>
            <h3>{{ (selectedArtist.id ? '::EditArtist' : '::NewArtist') | abpLocalization }}</h3>
        </ng-template>

        <ng-template #abpBody>
            <form [formGroup]="form" (ngSubmit)="save()">
                <div class="mb-3">
                    <label for="artist-name" class="form-label">{{ '::ArtistName' | abpLocalization }} *</label>
                    <input type="text" id="artist-name" class="form-control" formControlName="name" autofocus />
                    <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched"
                        class="invalid-feedback d-block">
                        <span *ngIf="form.get('name')?.errors?.['required']">{{ '::ThisFieldIsRequired' |
                            abpLocalization }}</span>
                        <span *ngIf="form.get('name')?.errors?.['maxlength']">{{ '::MaxLengthExceeded' | abpLocalization
                            }}</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="artist-type" class="form-label">{{ '::ArtistType' | abpLocalization }} *</label>
                    <select id="artist-type" class="form-select" formControlName="type">
                        <option [ngValue]="null">{{ '::PleaseSelect' | abpLocalization }}</option>
                        <option *ngFor="let type of artistTypes" [ngValue]="type.value">
                            {{ '::ArtistType:' + type.label | abpLocalization }}
                        </option>
                    </select>
                    <div *ngIf="form.get('type')?.invalid && form.get('type')?.touched"
                        class="invalid-feedback d-block">
                        <span *ngIf="form.get('type')?.errors?.['required']">{{ '::ThisFieldIsRequired' |
                            abpLocalization }}</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="artist-biography" class="form-label">{{ '::Biography' | abpLocalization }} *</label>
                    <textarea id="artist-biography" class="form-control" formControlName="biography"
                        rows="4"></textarea>
                    <div *ngIf="form.get('biography')?.invalid && form.get('biography')?.touched"
                        class="invalid-feedback d-block">
                        <span *ngIf="form.get('biography')?.errors?.['required']">{{ '::ThisFieldIsRequired' |
                            abpLocalization }}</span>
                        <span *ngIf="form.get('biography')?.errors?.['maxlength']">{{ '::MaxLengthExceeded' |
                            abpLocalization }}</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="artist-instagram" class="form-label">{{ '::InstagramHandle' | abpLocalization }}</label>
                    <input type="text" id="artist-instagram" class="form-control" formControlName="instagramHandle"
                        placeholder="@username" />
                </div>

                <div class="mb-3">
                    <label for="artist-website" class="form-label">{{ '::WebsiteUrl' | abpLocalization }}</label>
                    <input type="url" id="artist-website" class="form-control" formControlName="websiteUrl"
                        placeholder="https://example.com" />
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="artist-logo" class="form-label">{{ '::Logo' | abpLocalization }}</label>
                        <div class="image-upload-wrapper">
                            <div class="preview-box" *ngIf="logoPreview">
                                <img [src]="logoPreview" class="img-thumbnail" alt="Logo Preview">
                                <button type="button" class="btn btn-sm btn-danger delete-img"
                                    (click)="logoFile = null; logoPreview = null;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <input type="file" id="artist-logo" class="form-control" (change)="onLogoSelected($event)"
                                accept="image/*" />
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="artist-banner" class="form-label">{{ '::Banner' | abpLocalization }}</label>
                        <div class="image-upload-wrapper">
                            <div class="preview-box" *ngIf="bannerPreview">
                                <img [src]="bannerPreview" class="img-thumbnail" alt="Banner Preview">
                                <button type="button" class="btn btn-sm btn-danger delete-img"
                                    (click)="bannerFile = null; bannerPreview = null;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <input type="file" id="artist-banner" class="form-control"
                                (change)="onBannerSelected($event)" accept="image/*" />
                        </div>
                    </div>
                </div>

                <!-- PDF Template Upload -->
                <div class="mb-3">
                    <label for="artist-template" class="form-label">
                        {{ '::ProposalTemplate' | abpLocalization }}
                    </label>
                    <small class="text-muted d-block mb-2">
                        {{ '::ProposalTemplateInfo' | abpLocalization }}
                    </small>

                    <!-- Current Template Display -->
                    <div *ngIf="selectedArtist?.proposalTemplateUrl && !templateFile"
                        class="alert alert-info d-flex align-items-center justify-content-between mb-2">
                        <div>
                            <i class="fas fa-file-pdf me-2"></i>
                            <span>PDF de apresentação já cadastrado</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger" (click)="deleteTemplate()"
                            [disabled]="deletingTemplate">
                            <i class="fas fa-trash me-1"></i>
                            {{ '::DeleteProposalTemplate' | abpLocalization }}
                        </button>
                    </div>

                    <!-- Upload Input -->
                    <div class="input-group">
                        <input type="file" id="artist-template" class="form-control"
                            (change)="onTemplateSelected($event)" accept="application/pdf" />
                        <button type="button" class="btn btn-outline-secondary" *ngIf="templateFile"
                            (click)="templateFile = null">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Selected File Display -->
                    <div *ngIf="templateFile" class="mt-2">
                        <small class="text-success">
                            <i class="fas fa-check-circle me-1"></i>
                            {{ templateFile.name }} ({{ (templateFile.size / 1024 / 1024).toFixed(2) }} MB)
                        </small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="artist-color" class="form-label">Cor de Identificação</label>
                        <div class="d-flex align-items-center">
                            <input type="color" id="artist-color" class="form-control form-control-color"
                                formControlName="hexColor" />
                            <span class="ms-2 text-muted small">{{ form.get('hexColor')?.value }}</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="artist-tax" class="form-label">Imposto Padrão (%)</label>
                        <input type="number" id="artist-tax" class="form-control" formControlName="defaultTaxPercentage"
                            min="0" max="100" />
                    </div>
                </div>
            </form>
        </ng-template>

        <ng-template #abpFooter>
            <button type="button" class="btn btn-secondary" (click)="isModalOpen = false">
                {{ '::Cancel' | abpLocalization }}
            </button>
            <button class="btn btn-primary" type="button" [disabled]="form.invalid" (click)="save()">
                <i class="fa fa-check me-1"></i>
                {{ '::Save' | abpLocalization }}
            </button>
        </ng-template>
    </abp-modal>
</div>